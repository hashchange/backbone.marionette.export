// Backbone.Marionette.Export, v1.0.2
// Copyright (c)2014 Michael Heim, Zeilenwechsel.de
// Distributed under MIT license
// http://github.com/hashchange/backbone.marionette.export


!function(a,b){if("object"==typeof exports){var c=require("underscore"),d=require("backbone"),e=require("marionette");module.exports=b(c,d,e)}else"function"==typeof define&&define.amd&&define(["underscore","backbone","marionette"],b)}(this,function(_,Backbone){"option strict";return function(Backbone,_){"use strict";function a(a){var b,c=[];for(b=a;null!==b;b=Object.getPrototypeOf(b))c=c.concat(Object.getOwnPropertyNames(b));return _.unique(c)}var b=a([]);Backbone.Model.prototype.onBeforeExport=Backbone.Collection.prototype.onBeforeExport=function(){},Backbone.Model.prototype.onAfterExport=Backbone.Collection.prototype.onAfterExport=function(){},Backbone.Model.prototype.onExport=Backbone.Collection.prototype.onExport=function(a){return a},Backbone.Model.prototype.export=Backbone.Collection.prototype.export=function(){function a(a){return a&&a.export&&(a instanceof Backbone.Model||a instanceof Backbone.Collection)&&f<a.export.maxHops}var c,d,e,f;if(f=arguments.length?arguments[0]:0,this.onBeforeExport&&this.onBeforeExport(),this instanceof Backbone.Collection?c=this.map(function(b){return a(b)?b.export(f+1):b}):_.cloneDeep?c=_.cloneDeep(this.attributes,function(b){return a(b)?b.export(f+1):void 0}):(c=this.toJSON(),_.each(c,function(b,c,d){a(b)&&(d[c]=b.export(f+1))})),this.exportable&&(d=this.exportable,_.isArray(d)||(d=d?[d]:[]),_.each(d,function(b){var d;if(_.isUndefined(b))throw new Error("Can't export method. Undefined method reference");if(!_.isString(b))throw new Error("'exportable' property: Invalid method identifier");if(d=0===b.indexOf("this.")?b.substr(5):b,!this[d])throw new Error("Can't export \""+d+"\". The method doesn't exist");if(b=this[d],_.isFunction(b))c[d]=b.apply(this);else{if(this instanceof Backbone.Model)throw new Error("'exportable' property: Invalid method identifier \""+d+'", does not point to a function');c[d]=this[d]}_.cloneDeep?c[d]=_.cloneDeep(c[d],function(b){return a(b)?b.export(f+1):void 0}):a(c[d])&&(c[d]=c[d].export(f+1))},this)),this.onExport&&(c=this.onExport(c)),this.onAfterExport&&this.onAfterExport(),this instanceof Backbone.Collection&&(e=_.intersection(b,_.keys(c)),e.length))throw new Error("Can't export a property with a name which is reserved for a native array property. Offending properties: "+e);return c},Backbone.Model.prototype.export.maxHops=Backbone.Collection.prototype.export.maxHops=4,Backbone.Marionette&&(Backbone.Marionette.ItemView.prototype.serializeData=Backbone.Marionette.CompositeView.prototype.serializeData=function(){var a={};return this.model?a=this.model.export&&this.model.export()||this.model.toJSON():this.collection&&(a={items:this.collection.export&&this.collection.export()||this.collection.toJSON()}),a})}(Backbone,_),Backbone.Marionette.Export});
//# sourceMappingURL=backbone.marionette.export.min.map